<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Onam 2025 Brochure</title>
<style>
  body { text-align: center; background: #f8f4e7; font-family: sans-serif; margin: 0; }
  #flipbook { width: 90%; max-width: 900px; height: 80vh; margin: auto; }
  #flipbook .page { background: white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
  canvas { width: 100%; height: auto; display: block; }
</style>
</head>
<body>

<h1>Onam 2025 Brochure</h1>
<div id="flipbook"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/4.1.0/turn.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.min.js"></script>

<script>
const url = 'https://github.com/Crewlobbymadgaon/KeralaKalaKendram/raw/652ece621c730acaf450416807edb544e6fb7c97/kkkonam2025_compressed.pdf';

pdfjsLib.getDocument(url).promise.then(pdf => {
    const flipbook = $('#flipbook');
    const isMobile = window.innerWidth < 768;

    for (let i = 1; i <= pdf.numPages; i++) {
        flipbook.append(`<div class="page" data-page="${i}"></div>`);
    }

    flipbook.turn({
        width: isMobile ? window.innerWidth * 0.95 : 900,
        height: isMobile ? window.innerHeight * 0.75 : 600,
        autoCenter: true,
        display: isMobile ? 'single' : 'double',
        when: {
            turning: (event, page) => {
                loadPage(page);
                loadPage(page + 1);
                loadPage(page - 1);
            },
            turned: (event, page) => {
                loadPage(page + 2);
                loadPage(page - 2);
            }
        }
    });

    loadPage(1);
    if (!isMobile) loadPage(2); // Load page 2 on desktop start

    function loadPage(pageNum) {
        const pageDiv = $(`.page[data-page=${pageNum}]`);
        if (pageNum < 1 || pageNum > pdf.numPages || pageDiv.data('rendered')) return;

        pdf.getPage(pageNum).then(page => {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const scale = 1.5 * window.devicePixelRatio;
            const viewport = page.getViewport({ scale });
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            page.render({ canvasContext: ctx, viewport }).promise.then(() => {
                pageDiv.html('').append(canvas);
                pageDiv.data('rendered', true);
            });
        });
    }
});
</script>

</body>
</html>
