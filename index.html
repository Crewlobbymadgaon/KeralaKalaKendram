<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Flipbook - Single Page 3D Curl</title>

<!-- StPageFlip CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/stpageflip@2.0.7/dist/css/page-flip.min.css">

<style>
  :root {
    --bar-bg: rgba(0,0,0,.7);
    --bar-fg: #fff;
  }
  html, body {
    height: 100%;
    margin: 0;
    background: #f4f4f4;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }
  /* Centered book area */
  .stage {
    position: fixed;
    inset: 0;
    display: grid;
    place-items: center;
    padding-bottom: 64px; /* space for bottom bar */
  }
  /* Flipbook mount point (must have size > 0) */
  #flipbook {
    width: min(94vw, 560px);
    height: min(88vh, 780px);
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 10px 25px rgba(0,0,0,.15);
  }
  /* Bottom control bar */
  .controls {
    position: fixed;
    left: 0; right: 0; bottom: 0;
    height: 56px;
    background: var(--bar-bg);
    color: var(--bar-fg);
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    gap: 12px;
    padding: 0 12px env(safe-area-inset-bottom);
    -webkit-backdrop-filter: blur(6px);
    backdrop-filter: blur(6px);
  }
  .controls button {
    justify-self: start;
    border: 0;
    background: rgba(255,255,255,.15);
    color: #fff;
    height: 38px;
    min-width: 90px;
    padding: 0 14px;
    border-radius: 999px;
    font-weight: 700;
    cursor: pointer;
  }
  .controls button#nextBtn { justify-self: end; }
  .indicator { text-align: center; font-size: 14px; }
  /* Small helper for visible errors */
  .error {
    position: fixed; top: 10px; left: 50%; transform: translateX(-50%);
    background: #c62828; color: #fff; padding: 8px 12px; border-radius: 6px; display: none;
  }
</style>
</head>
<body>

<div class="error" id="errBox">Couldn’t load one or more images from /pdf/. Check filenames & paths.</div>

<div class="stage">
  <div id="flipbook" aria-label="Flipbook"></div>
</div>

<div class="controls">
  <button id="prevBtn">◀ Prev</button>
  <div class="indicator" id="indicator">Page 1 / 3</div>
  <button id="nextBtn">Next ▶</button>
</div>

<!-- StPageFlip JS (UMD, exposes global `St`) -->
<script src="https://cdn.jsdelivr.net/npm/stpageflip@2.0.7/dist/js/stpageflip.min.js"></script>
<script>
(function(){
  // Your images (relative paths). Make sure these exist in /pdf/
  const imagePaths = ["pdf/p1.webp", "pdf/p10.webp", "pdf/p11.webp"];

  const flipEl   = document.getElementById("flipbook");
  const prevBtn  = document.getElementById("prevBtn");
  const nextBtn  = document.getElementById("nextBtn");
  const indicator= document.getElementById("indicator");
  const errBox   = document.getElementById("errBox");

  // Preload images before initializing (avoids blank)
  function preloadImages(srcs) {
    return Promise.all(srcs.map(src => new Promise((resolve) => {
      const img = new Image();
      img.onload = () => resolve({src, ok:true});
      img.onerror = () => resolve({src, ok:false});
      img.src = src + ((/\?/).test(src) ? "&" : "?") + "v=" + Date.now(); // bust cache in dev
    })));
  }

  function updateIndicator(flip) {
    const state = flip.getCurrentPageIndex() + 1; // 1-based
    const total = flip.getPageCount();
    indicator.textContent = `Page ${state} / ${total}`;
  }

  function initFlip(imagesOk) {
    // Init StPageFlip with fixed page size to keep orientation stable
    const pageFlip = new St.PageFlip(flipEl, {
      width: 560,          // page width (px)
      height: 780,         // page height (px)
      size: "fixed",       // do not stretch during flip
      maxShadowOpacity: 0.5,
      showPageCorners: true,
      drawShadow: true,
      flippingTime: 800,
      usePortrait: true,   // single-page mode
      showCover: false,    // no special cover page
      mobileScrollSupport: false,
      useMouseEvents: true
    });

    // Build HTML pages
    const pages = imagesOk.map(p => {
      const el = document.createElement("div");
      el.className = "page";
      el.innerHTML = `<img src="${p.src}" alt="" style="width:100%;height:100%;object-fit:contain;">`;
      return el;
    });

    pageFlip.loadFromHTML(pages);

    // Controls
    prevBtn.addEventListener("click", () => pageFlip.flipPrev());
    nextBtn.addEventListener("click", () => pageFlip.flipNext());
    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowLeft") pageFlip.flipPrev();
      if (e.key === "ArrowRight") pageFlip.flipNext();
    });

    // Update indicator on events
    pageFlip.on("flip", () => updateIndicator(pageFlip));
    pageFlip.on("init", () => updateIndicator(pageFlip));

    // Touch swipe works out of the box.
    // Resize-safe: just keep the mount size; StPageFlip is fixed-sized internally.
    window.addEventListener("resize", () => {
      // keep outer container size responsive; no need to call size API since we're fixed
    });
  }

  // Start
  preloadImages(imagePaths).then(results => {
    const missing = results.filter(r => !r.ok);
    if (missing.length) {
      errBox.style.display = "block";
      console.warn("Missing images:", missing.map(m => m.src));
    }
    // Even if some are missing, load the ones that worked so you see something.
    const okImages = results.filter(r => r.ok);
    if (!okImages.length) return; // nothing to show
    initFlip(okImages);
  }).catch(err => {
    errBox.style.display = "block";
    console.error(err);
  });
})();
</script>

</body>
</html>
