<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Onam 2025 Brochure</title>
<style>
  body { text-align: center; background: #f8f4e7; font-family: sans-serif; margin: 0; }
  #flipbook { width: 90%; max-width: 900px; height: 600px; margin: auto; }
  #flipbook .page { background: white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
  canvas { width: 100%; height: auto; display: block; }
</style>
</head>
<body>

<h1>Onam 2025 Brochure</h1>
<div id="flipbook"></div>

<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!-- Working Turn.js v3 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/3/turn.min.js"></script>
<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.min.js"></script>

<script>
const url = 'https://github.com/Crewlobbymadgaon/KeralaKalaKendram/raw/652ece621c730acaf450416807edb544e6fb7c97/kkkonam2025_comp.pdf';

pdfjsLib.getDocument(url).promise.then(pdf => {
    const flipbook = $('#flipbook');

    // Create empty page containers
    for (let i = 1; i <= pdf.numPages; i++) {
        flipbook.append(`<div class="page" data-page="${i}"></div>`);
    }

    // Initialize flipbook AFTER creating page placeholders
    flipbook.turn({
        width: 900,
        height: 600,
        autoCenter: true
    });

    // Load page into flipbook
    function loadPage(pageNum) {
        const pageDiv = $(`.page[data-page=${pageNum}]`);
        if (pageDiv.data('rendered')) return;

        pdf.getPage(pageNum).then(page => {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const viewport = page.getViewport({ scale: 1.5 });
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            page.render({ canvasContext: ctx, viewport }).promise.then(() => {
                pageDiv.html('').append(canvas);
                pageDiv.data('rendered', true);
            });
        });
    }

    // Load first 2 pages
    loadPage(1);
    loadPage(2);

    // Load more pages when turning
    flipbook.bind('turning', (e, page) => {
        loadPage(page);
        loadPage(page + 1);
    });
});
</script>

</body>
</html>
